<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8"/>
    <title>BranchProbabilityInfo</title>
        <link rel="stylesheet" type="text/css" href="../clang-doc-mustache.css"/>
        <script src="../mustache-index.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar__container">
            <div class="navbar__logo">
                
            </div>
            <div class="navbar__menu">
                <ul class="navbar__links">
                    <li class="navbar__item">
                        <a href="../index.html" class="navbar__link">Home</a>
                    </li>
                </ul>
            </div>
            <div class="navbar-breadcrumb-container">
                <div class="navbar-breadcrumb-item"><a href="../GlobalNamespace/index.html">Global Namespace</a></div>&rarr;
                <div class="navbar-breadcrumb-item"><a href="./index.html">llvm</a></div>
            </div>
        </div>
    </nav>
    <main>
        <div class="container">
            <div class="sidebar">
                <h2>class BranchProbabilityInfo</h2>
                <ul>
                    <li class="sidebar-section">
                        <a class="sidebar-item" href="#PublicMethods">Public Method</a>
                    </li>
                    <li>
                        <ul>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#F6419F456F606CA762E40573BD314EBD7A8AEC49">BranchProbabilityInfo</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#FE017A04B33586DF62E29D3B758EA71EEDF217B8">BranchProbabilityInfo</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#937F1C67D9D31F147627CF8ACA719BF06C35C2C4">BranchProbabilityInfo</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#7040B57790E41A82E4120C08CAC913C4465D4224">BranchProbabilityInfo</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#05F952B0495B05C4DEE911502232230A261C36F9">operator=</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#2F70901AB5E9AF4C751E1E61400C57E86DDDBDA2">operator=</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#A661DC6D61C4A1AF064A3B8A593867F8D9D76ED8">getBranchProbStackProtector</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#CB161AB2FEACCE42AE5718F1F26B8304597E2684">invalidate</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#896AD5CBCC35AF1E0278C2673FABA0B0B44BD520">invalidate</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#CE4A86D96D803042466379A9460899BB2F9DFC67">releaseMemory</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#8904CE087CA6B02626667E56F699BB77E93FC511">print</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#AAB32BC75E065E33068DBBB8926435CD7E852587">getEdgeProbability</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#3F85813F86BABEB5EFE802D264F43D66F10286A5">getEdgeProbability</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#C17884EC8E2F277A3F8C3DCDF536959952E150FF">getEdgeProbability</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#BC4BC732BA795DD914B873C3AAB1BB01B17E13BB">isEdgeHot</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#A36BEBEFAC9C658A463F4617E4C1CFB0F63FF3A7">printEdgeProbability</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#8947D4204E35DEE05222FEE4E1E4DAC3048715BD">setEdgeProbability</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#41D5171B5834B8141ED407DCAC69367272676111">copyEdgeProbabilities</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#192CA87E34A15E06678E26BC5017F609B9C0F3A4">swapSuccEdgesProbabilities</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#D399986A01322259C9715A5B2BE0BFE0FEE8C866">calculate</a>
                            </li>
                            <li class="sidebar-item-container">
                                <a class="sidebar-item" href="#EEBB4976407A3D614726436AFC56AFD8BA9F4CBB">eraseBlock</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="resizer" id="resizer"></div>
            <div class="content">
                <section class="hero section-container">
                    <div class="hero__title">
                        <h1 class="hero__title-large">class BranchProbabilityInfo</h1>
                        <p>Defined at line 113 of file llvm/include/llvm/Analysis/BranchProbabilityInfo.h</p>
                        <div class="hero__subtitle">
                            <div>
                                <p> Analysis providing branch probability information.</p>
                            </div>
                            <div>
                                <p> This is a function analysis which provides information on the relative</p>
                                <p> probabilities of each &quot;edge&quot; in the function&#39;s CFG where such an edge is</p>
                                <p> defined by a pair (PredBlock and an index in the successors). The</p>
                                <p> probability of an edge from one block is always relative to the</p>
                                <p> probabilities of other edges from the block. The probabilites of all edges</p>
                                <p> from a block sum to exactly one (100%).</p>
                                <p> We use a pair (PredBlock and an index in the successors) to uniquely</p>
                                <p> identify an edge, since we can have multiple edges from Src to Dst.</p>
                                <p> As an example, we can have a switch which jumps to Dst with value 0 and</p>
                                <p> value 10.</p>
                            </div>
                            <div>
                                <p> Process of computing branch probabilities can be logically viewed as three</p>
                                <p> step process:</p>
                            </div>
                            <div>
                                <p>   First, if there is a profile information associated with the branch then</p>
                                <p> it is trivially translated to branch probabilities. There is one exception</p>
                                <p> from this rule though. Probabilities for edges leading to &quot;unreachable&quot;</p>
                                <p> blocks (blocks with the estimated weight not greater than</p>
                                <p> UNREACHABLE_WEIGHT) are evaluated according to static estimation and</p>
                                <p> override profile information. If no branch probabilities were calculated</p>
                                <p> on this step then take the next one.</p>
                            </div>
                            <div>
                                <p>   Second, estimate absolute execution weights for each block based on</p>
                                <p> statically known information. Roots of such information are &quot;cold&quot;,</p>
                                <p> &quot;unreachable&quot;, &quot;noreturn&quot; and &quot;unwind&quot; blocks. Those blocks get their</p>
                                <p> weights set to BlockExecWeight::COLD, BlockExecWeight::UNREACHABLE,</p>
                                <p> BlockExecWeight::NORETURN and BlockExecWeight::UNWIND respectively. Then the</p>
                                <p> weights are propagated to the other blocks up the domination line. In</p>
                                <p> addition, if all successors have estimated weights set then maximum of these</p>
                                <p> weights assigned to the block itself (while this is not ideal heuristic in</p>
                                <p> theory it&#39;s simple and works reasonably well in most cases) and the process</p>
                                <p> repeats. Once the process of weights propagation converges branch</p>
                                <p> probabilities are set for all such branches that have at least one successor</p>
                                <p> with the weight set. Default execution weight (BlockExecWeight::DEFAULT) is</p>
                                <p> used for any successors which doesn&#39;t have its weight set. For loop back</p>
                                <p> branches we use their weights scaled by loop trip count equal to</p>
                                <p> &#39;LBH_TAKEN_WEIGHT/LBH_NOTTAKEN_WEIGHT&#39;.</p>
                            </div>
                            <div>
                                <p> Here is a simple example demonstrating how the described algorithm works.</p>
                            </div>
                            <div>
                                <p>          BB1</p>
                                <p>         /   </p>
                                <p>\</p>
                                <p>///        v     v</p>
                                <p>      BB2     BB3</p>
                                <p>     /   </p>
                                <p>\</p>
                                <p>///    v     v</p>
                                <p>  ColdBB  UnreachBB</p>
                            </div>
                            <div>
                                <p> Initially, ColdBB is associated with COLD_WEIGHT and UnreachBB with</p>
                                <p> UNREACHABLE_WEIGHT. COLD_WEIGHT is set to BB2 as maximum between its</p>
                                <p> successors. BB1 and BB3 has no explicit estimated weights and assumed to</p>
                                <p> have DEFAULT_WEIGHT. Based on assigned weights branches will have the</p>
                                <p> following probabilities:</p>
                                <p> P(BB1-&gt;BB2) = COLD_WEIGHT/(COLD_WEIGHT + DEFAULT_WEIGHT) =</p>
                                <p>   0xffff / (0xffff + 0xfffff) = 0.0588(5.9%)</p>
                                <p> P(BB1-&gt;BB3) = DEFAULT_WEIGHT_WEIGHT/(COLD_WEIGHT + DEFAULT_WEIGHT) =</p>
                                <p>          0xfffff / (0xffff + 0xfffff) = 0.941(94.1%)</p>
                                <p> P(BB2-&gt;ColdBB) = COLD_WEIGHT/(COLD_WEIGHT + UNREACHABLE_WEIGHT) = 1(100%)</p>
                                <p> P(BB2-&gt;UnreachBB) =</p>
                                <p>   UNREACHABLE_WEIGHT/(COLD_WEIGHT+UNREACHABLE_WEIGHT) = 0(0%)</p>
                            </div>
                            <div>
                                <p> If no branch probabilities were calculated on this step then take the next</p>
                                <p> one.</p>
                            </div>
                            <div>
                                <p>   Third, apply different kinds of local heuristics for each individual</p>
                                <p> branch until first match. For example probability of a pointer to be null is</p>
                                <p> estimated as PH_TAKEN_WEIGHT/(PH_TAKEN_WEIGHT + PH_NONTAKEN_WEIGHT). If</p>
                                <p> no local heuristic has been matched then branch is left with no explicit</p>
                                <p> probability set and assumed to have default probability.</p>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="PublicMethods" class="section-container">
                    <h2>Public Methods</h2>
                    <div>
                        <div class="delimiter-container">
                            <div id="F6419F456F606CA762E40573BD314EBD7A8AEC49">
                                <pre><code class="language-cpp code-clang-doc">void BranchProbabilityInfo ()</code></pre>
                                <p>Defined at line 115 of file llvm/include/llvm/Analysis/BranchProbabilityInfo.h</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="FE017A04B33586DF62E29D3B758EA71EEDF217B8">
                                <pre><code class="language-cpp code-clang-doc">void BranchProbabilityInfo (const Function &amp; F, const LoopInfo &amp; LI, const TargetLibraryInfo * TLI, DominatorTree * DT, PostDominatorTree * PDT)</code></pre>
                                <p>Defined at line 117 of file llvm/include/llvm/Analysis/BranchProbabilityInfo.h</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="937F1C67D9D31F147627CF8ACA719BF06C35C2C4">
                                <pre><code class="language-cpp code-clang-doc">void BranchProbabilityInfo (BranchProbabilityInfo &amp;&amp; Arg)</code></pre>
                                <p>Defined at line 124 of file llvm/include/llvm/Analysis/BranchProbabilityInfo.h</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="7040B57790E41A82E4120C08CAC913C4465D4224">
                                <pre><code class="language-cpp code-clang-doc">void BranchProbabilityInfo (const BranchProbabilityInfo &amp; )</code></pre>
                                <p>Defined at line 132 of file llvm/include/llvm/Analysis/BranchProbabilityInfo.h</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="05F952B0495B05C4DEE911502232230A261C36F9">
                                <pre><code class="language-cpp code-clang-doc">BranchProbabilityInfo &amp; operator= (const BranchProbabilityInfo &amp; )</code></pre>
                                <p>Defined at line 133 of file llvm/include/llvm/Analysis/BranchProbabilityInfo.h</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="2F70901AB5E9AF4C751E1E61400C57E86DDDBDA2">
                                <pre><code class="language-cpp code-clang-doc">BranchProbabilityInfo &amp; operator= (BranchProbabilityInfo &amp;&amp; RHS)</code></pre>
                                <p>Defined at line 135 of file llvm/include/llvm/Analysis/BranchProbabilityInfo.h</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="A661DC6D61C4A1AF064A3B8A593867F8D9D76ED8">
                                <pre><code class="language-cpp code-clang-doc">BranchProbability getBranchProbStackProtector (bool IsLikely)</code></pre>
                                <p>Defined at line 204 of file llvm/include/llvm/Analysis/BranchProbabilityInfo.h</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="CB161AB2FEACCE42AE5718F1F26B8304597E2684">
                                <pre><code class="language-cpp code-clang-doc">bool invalidate (Function &amp; , const PreservedAnalyses &amp; PA, int &amp; )</code></pre>
                                <p>Defined at line  of file </p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="896AD5CBCC35AF1E0278C2673FABA0B0B44BD520">
                                <pre><code class="language-cpp code-clang-doc">bool invalidate (Function &amp; , const PreservedAnalyses &amp; PA, FunctionAnalysisManager::Invalidator &amp; )</code></pre>
                                <p>Defined at line 1059 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="CE4A86D96D803042466379A9460899BB2F9DFC67">
                                <pre><code class="language-cpp code-clang-doc">void releaseMemory ()</code></pre>
                                <p>Defined at line 1054 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="8904CE087CA6B02626667E56F699BB77E93FC511">
                                <pre><code class="language-cpp code-clang-doc">void print (raw_ostream &amp; OS)</code></pre>
                                <p>Defined at line 1068 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="AAB32BC75E065E33068DBBB8926435CD7E852587">
                                <pre><code class="language-cpp code-clang-doc">BranchProbability getEdgeProbability (const BasicBlock * Src, unsigned int IndexInSuccessors)</code></pre>
                                <div>
                                    <div>
                                        <p> Get an edge&#39;s probability, relative to other out-edges of the Src.</p>
                                    </div>
                                    <div>
                                        <p> This routine provides access to the fractional probability between zero</p>
                                        <p> (0%) and one (100%) of this edge executing, relative to other edges</p>
                                        <p> leaving the &#39;Src&#39; block. The returned probability is never zero, and can</p>
                                        <p> only be one if the source block has only one successor.</p>
                                    </div>
                                </div>
                                <p>Defined at line 1090 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="3F85813F86BABEB5EFE802D264F43D66F10286A5">
                                <pre><code class="language-cpp code-clang-doc">BranchProbability getEdgeProbability (const BasicBlock * Src, const BasicBlock * Dst)</code></pre>
                                <div>
                                    <div>
                                        <p> Get the probability of going from Src to Dst.</p>
                                    </div>
                                    <div>
                                        <p> It returns the sum of all probabilities for edges from Src to Dst.</p>
                                    </div>
                                </div>
                                <p>Defined at line 1113 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="C17884EC8E2F277A3F8C3DCDF536959952E150FF">
                                <pre><code class="language-cpp code-clang-doc">BranchProbability getEdgeProbability (const BasicBlock * Src, SuccIterator Dst)</code></pre>
                                <p>Defined at line 1105 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="BC4BC732BA795DD914B873C3AAB1BB01B17E13BB">
                                <pre><code class="language-cpp code-clang-doc">bool isEdgeHot (const BasicBlock * Src, const BasicBlock * Dst)</code></pre>
                                <div>
                                    <div>
                                        <p> Test if an edge is hot relative to other out-edges of the Src.</p>
                                    </div>
                                    <div>
                                        <p> Check whether this edge out of the source block is &#39;hot&#39;. We define hot</p>
                                        <p> as having a relative probability &gt; 80%.</p>
                                    </div>
                                </div>
                                <p>Defined at line 1079 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="A36BEBEFAC9C658A463F4617E4C1CFB0F63FF3A7">
                                <pre><code class="language-cpp code-clang-doc">raw_ostream &amp; printEdgeProbability (raw_ostream &amp; OS, const BasicBlock * Src, const BasicBlock * Dst)</code></pre>
                                <div>
                                    <div>
                                        <p> Print an edge&#39;s probability.</p>
                                    </div>
                                    <div>
                                        <p> Retrieves an edge&#39;s probability similarly to </p>
                                    </div>
                                </div>
                                <p>Defined at line 1184 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="8947D4204E35DEE05222FEE4E1E4DAC3048715BD">
                                <pre><code class="language-cpp code-clang-doc">void setEdgeProbability (const BasicBlock * Src, const SmallVectorImpl&lt;BranchProbability&gt; &amp; Probs)</code></pre>
                                <div>
                                    <div>
                                        <p> Set the edge probability for all edges at once.</p>
                                    </div>
                                </div>
                                <p>Defined at line 1128 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="41D5171B5834B8141ED407DCAC69367272676111">
                                <pre><code class="language-cpp code-clang-doc">void copyEdgeProbabilities (BasicBlock * Src, BasicBlock * Dst)</code></pre>
                                <div>
                                    <div>
                                        <p> Copy outgoing edge probabilities from </p>
                                        <p> to </p>
                                    </div>
                                    <div>
                                        <p> This allows to keep probabilities unset for the destination if they were</p>
                                        <p> unset for source.</p>
                                    </div>
                                </div>
                                <p>Defined at line 1155 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="192CA87E34A15E06678E26BC5017F609B9C0F3A4">
                                <pre><code class="language-cpp code-clang-doc">void swapSuccEdgesProbabilities (const BasicBlock * Src)</code></pre>
                                <div>
                                    <div>
                                        <p> Swap outgoing edges probabilities for </p>
                                        <p> with branch terminator</p>
                                    </div>
                                </div>
                                <p>Defined at line 1174 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="D399986A01322259C9715A5B2BE0BFE0FEE8C866">
                                <pre><code class="language-cpp code-clang-doc">void calculate (const Function &amp; F, const LoopInfo &amp; LI, const TargetLibraryInfo * TLI, DominatorTree * DT, PostDominatorTree * PDT)</code></pre>
                                <p>Defined at line 1221 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                        <div class="delimiter-container">
                            <div id="EEBB4976407A3D614726436AFC56AFD8BA9F4CBB">
                                <pre><code class="language-cpp code-clang-doc">void eraseBlock (const BasicBlock * BB)</code></pre>
                                <div>
                                    <div>
                                        <p> Forget analysis results for the given basic block.</p>
                                    </div>
                                </div>
                                <p>Defined at line 1199 of file llvm/lib/Analysis/BranchProbabilityInfo.cpp</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>
</body>
</html>
